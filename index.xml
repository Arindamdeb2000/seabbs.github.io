<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sam Abbott on Sam Abbott</title>
    <link>http://www.samabbott.co.uk/</link>
    <description>Recent content in Sam Abbott on Sam Abbott</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-uk</language>
    <copyright>&amp;copy; 2017 Sam Abbott</copyright>
    <lastBuildDate>Wed, 20 Apr 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Exploring Estimates of the Tuberculosis Case Fatality Ratio - with getTBinR</title>
      <link>http://www.samabbott.co.uk/post/est-cfr-gettbinr/</link>
      <pubDate>Tue, 27 Feb 2018 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/est-cfr-gettbinr/</guid>
      <description>&lt;p&gt;This is a quick post exploring estimates of the case fatality ratio for Tuberculosis (TB) from &lt;a href=&#34;http://www.who.int/tb/country/data/download/en/&#34;&gt;data&lt;/a&gt; published by the World Health Organisation (WHO). It makes use of &lt;a href=&#34;https://www.samabbott.co.uk/getTBinR&#34;&gt;getTBinR&lt;/a&gt; (which is now on &lt;a href=&#34;https://cran.r-project.org/web/packages/getTBinR/index.html&#34;&gt;CRAN&lt;/a&gt;), &lt;a href=&#34;https://github.com/trinker/pacman&#34;&gt;pacman&lt;/a&gt; for package management, &lt;a href=&#34;https://github.com/hrbrmstr/hrbrthemes&#34;&gt;hrbrthemes&lt;/a&gt; for plot themes, and &lt;a href=&#34;https://github.com/thomasp85/patchwork&#34;&gt;pathwork&lt;/a&gt; for combining multiple plots into a storyboard. For an introduction to using getTBinR to explore the WHO TB data see &lt;a href=&#34;https://www.samabbott.co.uk/post/intro-gettbinr/&#34;&gt;this&lt;/a&gt; post.&lt;/p&gt;
&lt;p&gt;It is estimated that in 2016 there was more than 10 million cases of active TB, with 1.3 million deaths (&lt;a href=&#34;https://en.wikipedia.org/wiki/Tuberculosis&#34;&gt;source&lt;/a&gt;). This makes TB the leading cause of death from an infectious disease. Despite the high numbers of cases globally, and high levels of mortality, TB is often considered a historic disease in developed countries. However, in recent years previously declining trends have flattened out and there is increasing concern surrounding multi-drug resistant TB, which has a greatly reduced the rate of successful treatment (&lt;a href=&#34;http://www.who.int/mediacentre/factsheets/fs104/en/&#34;&gt;source&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;A key component of TB control is reducing the case fatality rate from active TB, this post explores WHO estimates for the TB case fatality rate in 2016 and then estimates the case fatality rates in previous years. The first step is to download and install the required packages, &lt;code&gt;pacman&lt;/code&gt; is used to manage this process.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(pacman)) install.packages(&amp;quot;pacman&amp;quot;); library(pacman)
p_load(&amp;quot;getTBinR&amp;quot;)
p_load(&amp;quot;tidyverse&amp;quot;)
p_load(&amp;quot;viridis&amp;quot;)
p_load(&amp;quot;hrbrthemes&amp;quot;)
p_load(&amp;quot;scales&amp;quot;)
p_load_gh(&amp;quot;thomasp85/patchwork&amp;quot;, dependencies = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we use &lt;code&gt;getTBinR&lt;/code&gt; to download the TB burden data and its accompanying data dictionary.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tb_burden &amp;lt;- get_tb_burden(verbose = FALSE)
dict &amp;lt;- get_data_dict(verbose = FALSE)

tb_burden&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3,651 x 71
##    country  iso2  iso3  iso_numeric g_whoregion  year e_pop_num e_inc_100k
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;       &amp;lt;int&amp;gt;     &amp;lt;int&amp;gt;      &amp;lt;dbl&amp;gt;
##  1 Afghani… AF    AFG             4 Eastern Me…  2000  20093756       190.
##  2 Afghani… AF    AFG             4 Eastern Me…  2001  20966463       189.
##  3 Afghani… AF    AFG             4 Eastern Me…  2002  21979923       189.
##  4 Afghani… AF    AFG             4 Eastern Me…  2003  23064851       189.
##  5 Afghani… AF    AFG             4 Eastern Me…  2004  24118979       189.
##  6 Afghani… AF    AFG             4 Eastern Me…  2005  25070798       189.
##  7 Afghani… AF    AFG             4 Eastern Me…  2006  25893450       189.
##  8 Afghani… AF    AFG             4 Eastern Me…  2007  26616792       189.
##  9 Afghani… AF    AFG             4 Eastern Me…  2008  27294031       189.
## 10 Afghani… AF    AFG             4 Eastern Me…  2009  28004331       189.
## # ... with 3,641 more rows, and 63 more variables: e_inc_100k_lo &amp;lt;dbl&amp;gt;,
## #   e_inc_100k_hi &amp;lt;dbl&amp;gt;, e_inc_num &amp;lt;int&amp;gt;, e_inc_num_lo &amp;lt;int&amp;gt;,
## #   e_inc_num_hi &amp;lt;int&amp;gt;, e_inc_num_f014 &amp;lt;int&amp;gt;, e_inc_num_f014_lo &amp;lt;int&amp;gt;,
## #   e_inc_num_f014_hi &amp;lt;int&amp;gt;, e_inc_num_f15plus &amp;lt;int&amp;gt;,
## #   e_inc_num_f15plus_lo &amp;lt;int&amp;gt;, e_inc_num_f15plus_hi &amp;lt;int&amp;gt;,
## #   e_inc_num_f &amp;lt;int&amp;gt;, e_inc_num_f_lo &amp;lt;int&amp;gt;, e_inc_num_f_hi &amp;lt;int&amp;gt;,
## #   e_inc_num_m014 &amp;lt;int&amp;gt;, e_inc_num_m014_lo &amp;lt;int&amp;gt;,
## #   e_inc_num_m014_hi &amp;lt;int&amp;gt;, e_inc_num_m15plus &amp;lt;int&amp;gt;,
## #   e_inc_num_m15plus_lo &amp;lt;int&amp;gt;, e_inc_num_m15plus_hi &amp;lt;int&amp;gt;,
## #   e_inc_num_m &amp;lt;int&amp;gt;, e_inc_num_m_lo &amp;lt;int&amp;gt;, e_inc_num_m_hi &amp;lt;int&amp;gt;,
## #   e_inc_num_014 &amp;lt;int&amp;gt;, e_inc_num_014_lo &amp;lt;int&amp;gt;, e_inc_num_014_hi &amp;lt;int&amp;gt;,
## #   e_inc_num_15plus &amp;lt;int&amp;gt;, e_inc_num_15plus_lo &amp;lt;int&amp;gt;,
## #   e_inc_num_15plus_hi &amp;lt;int&amp;gt;, e_tbhiv_prct &amp;lt;dbl&amp;gt;, e_tbhiv_prct_lo &amp;lt;dbl&amp;gt;,
## #   e_tbhiv_prct_hi &amp;lt;dbl&amp;gt;, e_inc_tbhiv_100k &amp;lt;dbl&amp;gt;,
## #   e_inc_tbhiv_100k_lo &amp;lt;dbl&amp;gt;, e_inc_tbhiv_100k_hi &amp;lt;dbl&amp;gt;,
## #   e_inc_tbhiv_num &amp;lt;int&amp;gt;, e_inc_tbhiv_num_lo &amp;lt;int&amp;gt;,
## #   e_inc_tbhiv_num_hi &amp;lt;int&amp;gt;, e_mort_exc_tbhiv_100k &amp;lt;dbl&amp;gt;,
## #   e_mort_exc_tbhiv_100k_lo &amp;lt;dbl&amp;gt;, e_mort_exc_tbhiv_100k_hi &amp;lt;dbl&amp;gt;,
## #   e_mort_exc_tbhiv_num &amp;lt;int&amp;gt;, e_mort_exc_tbhiv_num_lo &amp;lt;int&amp;gt;,
## #   e_mort_exc_tbhiv_num_hi &amp;lt;int&amp;gt;, e_mort_tbhiv_100k &amp;lt;dbl&amp;gt;,
## #   e_mort_tbhiv_100k_lo &amp;lt;dbl&amp;gt;, e_mort_tbhiv_100k_hi &amp;lt;dbl&amp;gt;,
## #   e_mort_tbhiv_num &amp;lt;int&amp;gt;, e_mort_tbhiv_num_lo &amp;lt;int&amp;gt;,
## #   e_mort_tbhiv_num_hi &amp;lt;int&amp;gt;, e_mort_100k &amp;lt;dbl&amp;gt;, e_mort_100k_lo &amp;lt;dbl&amp;gt;,
## #   e_mort_100k_hi &amp;lt;dbl&amp;gt;, e_mort_num &amp;lt;int&amp;gt;, e_mort_num_lo &amp;lt;int&amp;gt;,
## #   e_mort_num_hi &amp;lt;int&amp;gt;, cfr &amp;lt;dbl&amp;gt;, cfr_lo &amp;lt;dbl&amp;gt;, cfr_hi &amp;lt;dbl&amp;gt;,
## #   c_newinc_100k &amp;lt;dbl&amp;gt;, c_cdr &amp;lt;dbl&amp;gt;, c_cdr_lo &amp;lt;dbl&amp;gt;, c_cdr_hi &amp;lt;dbl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dict&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 402 x 4
##    variable_name            dataset              code_list   definition   
##    &amp;lt;chr&amp;gt;                    &amp;lt;chr&amp;gt;                &amp;lt;chr&amp;gt;       &amp;lt;chr&amp;gt;        
##  1 bmu                      Community engagement &amp;quot;&amp;quot;          Number of TB…
##  2 bmu_community_impl       Community engagement &amp;quot;&amp;quot;          Number of TB…
##  3 bmu_ref_data             Community engagement &amp;quot;&amp;quot;          Number of Ba…
##  4 bmu_rxsupport_data       Community engagement &amp;quot;&amp;quot;          Number of Ba…
##  5 bmu_rxsupport_data_coh   Community engagement &amp;quot;&amp;quot;          Total number…
##  6 community_data_available Community engagement 0=No; 1=Yes Are data ava…
##  7 notified_ref             Community engagement &amp;quot;&amp;quot;          Total number…
##  8 notified_ref_community   Community engagement &amp;quot;&amp;quot;          Total number…
##  9 rxsupport_community_coh  Community engagement &amp;quot;&amp;quot;          Total number…
## 10 rxsupport_community_succ Community engagement &amp;quot;&amp;quot;          Total number…
## # ... with 392 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We want to explore the case fatality rate (&lt;code&gt;cfr&lt;/code&gt;), lets first look at the WHO definition.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;search_data_dict(&amp;quot;cfr&amp;quot;, verbose = FALSE) %&amp;gt;% 
  knitr::kable()&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;left&#34;&gt;variable_name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;dataset&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;code_list&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;definition&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;cfr&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated TB case fatality ratio&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Maps can be a useful first visualisation for summarising spatial data, although they can also be misleading for more complex comparisons. Lets look at global TB incidence rates (per 100,000 population) in 2016, and the WHO estimate of the case fatality ratio in the same year.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Map TB incidence rates - 2016
mp1 &amp;lt;- map_tb_burden(year = 2016, verbose = FALSE) +
  scale_fill_viridis(option = &amp;quot;cividis&amp;quot;, direction = -1) +
  labs(title = &amp;quot;Map of Tuberculosis Incidence Rates - 2016&amp;quot;,
       subtitle = &amp;quot;Incidence rates are per 100,000 population&amp;quot;)

mp1 +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/make-inc-map-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Map TB case fatality ratio -2016
mp2 &amp;lt;- map_tb_burden(metric = &amp;quot;cfr&amp;quot;, year = 2016, verbose= FALSE) +
  scale_fill_viridis(option = &amp;quot;cividis&amp;quot;, direction = -1) +
  labs(title = &amp;quot;Map of Tuberculosis Case Fatality Ratio - 2016&amp;quot;,
       subtitle = &amp;quot;Case fatality rate estimated by the WHO&amp;quot;)

mp2 +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/make-cfr-map-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Whilst quantitative insights are hard to glean from the above maps we can see that incidence rates appear to be highest in Africa and Asia. It also looks like the case fatality ratios are highest in these regions as well.&lt;/p&gt;
&lt;p&gt;The WHO have only provided estimates for the case fatality ratio for 2016, estimating the case fatality ratio for other years will allow trends over time to be explored. We do this by first summarising TB incidence rates, and mortality rates by region. This allows insights into the general global picture to be more easily extracted. The first step is to write a function to summarise rates on regional levels, we do this using &lt;code&gt;dplyr::summarise_at&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## Make function to summarise rates in a given region
rate_region &amp;lt;- function(df = NULL, metric = NULL) {
  
  metric_vars &amp;lt;- c(metric, paste0(metric, &amp;quot;_lo&amp;quot;), paste0(metric, &amp;quot;_hi&amp;quot;))
  
  df &amp;lt;- df %&amp;gt;% 
    group_by(year, g_whoregion) %&amp;gt;% 
    summarise_at(.vars = c(metric_vars, &amp;quot;e_pop_num&amp;quot;),
                 .funs = funs(sum(as.numeric(.), na.rm = T))) %&amp;gt;% 
    ungroup() %&amp;gt;% 
    mutate_at(.vars = metric_vars,
              .funs = funs(. / e_pop_num * 1e5))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We then write a reusable plotting function to visualise this data (making use of &lt;code&gt;aes_string&lt;/code&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## Plotting function for rates
plot_rate_region &amp;lt;- function(df = NULL, metric = NULL, title = NULL, subtitle = NULL, 
                             y_lab = NULL, scales = NULL) {
  
  metric_vars &amp;lt;- c(metric, paste0(metric, &amp;quot;_lo&amp;quot;), paste0(metric, &amp;quot;_hi&amp;quot;))
  
  df %&amp;gt;% 
    ggplot(aes_string(x = &amp;quot;year&amp;quot;, y = metric, col = &amp;quot;g_whoregion&amp;quot;, 
                      fill = &amp;quot;g_whoregion&amp;quot;)) +
    geom_point(size = 1.3) +
    geom_ribbon(aes_string(ymin = metric_vars[2], ymax = metric_vars[3]), alpha = 0.3) +
    geom_line(size = 1.1) +
    scale_y_continuous(labels = comma) +
    scale_colour_viridis(discrete = TRUE, option = &amp;quot;E&amp;quot;) +
    scale_fill_viridis(discrete = TRUE, option = &amp;quot;E&amp;quot;) +
    labs(title = title, subtitle = subtitle, 
         x = &amp;quot;Year&amp;quot;, y = y_lab) +
    theme_ipsum() +
    theme(legend.position = &amp;quot;none&amp;quot;) +
    facet_wrap(~g_whoregion, scales = scales)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can now quickly plot TB incidence rates by region, as well as mortality rates by region.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_inc_region &amp;lt;- tb_burden %&amp;gt;% 
  rate_region(metric = &amp;quot;e_inc_num&amp;quot;) %&amp;gt;% 
  plot_rate_region(metric = &amp;quot;e_inc_num&amp;quot;,
                   title = &amp;quot;Tuberculosis Incidence Rates&amp;quot;,
                   subtitle = &amp;quot;By WHO region: 2000 to 2016&amp;quot;,
                   scales = &amp;quot;free_y&amp;quot;,
                   y_lab = &amp;quot;Tuberculosis Incidence Rates (per 100,000 population)&amp;quot;)

plot_inc_region +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/plot-tb-inc-reg-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_mort_region &amp;lt;- tb_burden %&amp;gt;% 
  rate_region(metric = &amp;quot;e_mort_num&amp;quot;) %&amp;gt;% 
  plot_rate_region(metric = &amp;quot;e_mort_num&amp;quot;,
                   title = &amp;quot;Tuberculosis Mortality Rates&amp;quot;,
                   subtitle = &amp;quot;By WHO region: 2000 to 2016&amp;quot;,
                   scales = &amp;quot;free_y&amp;quot;,
                   y_lab = &amp;quot;Tuberculosis Mortality Rates (per 100,000 population)&amp;quot;)

plot_mort_region +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/plot-tb-mort-reg-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This gives an encouraging picture with both incidence rates and mortality rates declining in all regions. As we observed from the maps above incidence rates (and mortality rates) are highest in Africa, and South-East Asia. We also see that the rate of decline in incidence rates varies across regions, with South-East Asia and the Eastern Mediterranean experiencing the slowest decreases. Interestingly it also appears that mortality rates in some areas are decreasing more quickly than incidence rates, this is most notable for Europe. As mortality rates and incidence rates are highly correlated to explore in more depth we need to estimate the case fatality ratio for all years in the data.&lt;/p&gt;
&lt;p&gt;To validate our estimates we first extract the regional estimates for the case fatality ratio based on the WHO estimates, by taking the mean (and standard deviation) of case fatality ratios by country in each region. This gives an estimate for case fatality rates at the regional level as well as the between country variation.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## Summarise Case fatality rate by region - only availble for 2016
region_case_fat &amp;lt;- tb_burden %&amp;gt;% 
  filter(year %in% 2016) %&amp;gt;% 
  group_by(year, g_whoregion) %&amp;gt;% 
  summarise(mean = mean(cfr, na.rm = TRUE),
            sd = sd(cfr, na.rm = TRUE)) %&amp;gt;% 
  mutate(ll = mean - sd,
         lll = mean - 2*sd,
         hh = mean + sd,
         hhh = mean + 2 * sd)

region_case_fat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 8
## # Groups:   year [1]
##    year g_whoregion             mean     sd       ll      lll    hh   hhh
##   &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;                  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  2016 Africa                0.238  0.0899  0.148    0.0581  0.328 0.418
## 2  2016 Americas              0.132  0.133  -0.00116 -0.134   0.265 0.397
## 3  2016 Eastern Mediterranean 0.131  0.129   0.00173 -0.127   0.260 0.389
## 4  2016 Europe                0.0837 0.0458  0.0379  -0.00792 0.130 0.175
## 5  2016 South-East Asia       0.135  0.0439  0.0916   0.0477  0.179 0.223
## 6  2016 Western Pacific       0.0885 0.0483  0.0402  -0.00810 0.137 0.185&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We then estimate the regional case fatality ratio by taking the regional mortality rate and dividing it by the regional incidence rate for each year. We also do this for the high and low mortality rate estimates (using the lowest estimate for TB mortality and the highest estimate for incidence rates to get the lower bound, and vice versa for the high bound). This gives,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;region_case_fatality &amp;lt;- tb_burden %&amp;gt;% 
  rate_region(metric = &amp;quot;e_inc_num&amp;quot;) %&amp;gt;% 
  left_join(tb_burden %&amp;gt;% 
              rate_region(metric = &amp;quot;e_mort_num&amp;quot;)) %&amp;gt;% 
  mutate(case_fat_rate = e_mort_num / e_inc_num,
         case_fat_rate_lo = e_mort_num_lo / e_inc_num_hi,
         case_fat_rate_hi = e_mort_num_hi / e_inc_num_lo)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = c(&amp;quot;year&amp;quot;, &amp;quot;g_whoregion&amp;quot;, &amp;quot;e_pop_num&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;region_case_fatality&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 102 x 12
##     year g_whoregion        e_inc_num e_inc_num_lo e_inc_num_hi  e_pop_num
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;                  &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1  2000 Africa                 332.         210.         481.      6.59e8
##  2  2000 Americas                36.5         28.6         45.6     8.38e8
##  3  2000 Eastern Mediterra…     127.          87.0        175.      4.81e8
##  4  2000 Europe                  52.3         38.1         68.8     8.69e8
##  5  2000 South-East Asia        305.         175.         473.      1.57e9
##  6  2000 Western Pacific        131.          91.9        178.      1.70e9
##  7  2001 Africa                 337.         215.         487.      6.76e8
##  8  2001 Americas                35.0         27.4         43.6     8.48e8
##  9  2001 Eastern Mediterra…     126.          86.2        174.      4.92e8
## 10  2001 Europe                  51.9         37.7         68.3     8.70e8
## # ... with 92 more rows, and 6 more variables: e_mort_num &amp;lt;dbl&amp;gt;,
## #   e_mort_num_lo &amp;lt;dbl&amp;gt;, e_mort_num_hi &amp;lt;dbl&amp;gt;, case_fat_rate &amp;lt;dbl&amp;gt;,
## #   case_fat_rate_lo &amp;lt;dbl&amp;gt;, case_fat_rate_hi &amp;lt;dbl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can then plot this using the &lt;code&gt;plot_rate_region&lt;/code&gt; function outlined above, combined with addition layers to compare our estimate to that produced by the WHO.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_region_case_fatality &amp;lt;- region_case_fatality %&amp;gt;%
  plot_rate_region(metric = &amp;quot;case_fat_rate&amp;quot;,
                   title = &amp;quot;Tuberculosis Case Fatality Rate&amp;quot;,
                   subtitle = &amp;quot;By WHO region: 2000 to 2016&amp;quot;,
                   scales = &amp;quot;free_y&amp;quot;,
                   y_lab = &amp;quot;Estimated TB Case Fatality Ratio&amp;quot;) +
  labs(caption = &amp;quot;Case fatality ratio estimated by taking the ratio of TB mortality rates and TB incidence rates each year in all years. For 2016 
       the mean regional case fatality ratio estimated by the WHO is also shown (along with one and two standard deviations)&amp;quot;) +
  geom_point(data = region_case_fat, aes(y = mean, x = year, fill = g_whoregion), shape = 2, size = 1.3, col = &amp;quot;black&amp;quot;) +
  geom_linerange(data = region_case_fat, aes(ymin = ll, ymax = hh, y = NULL), alpha = 0.4, size = 1.2, col = &amp;quot;black&amp;quot;) +
  geom_linerange(data = region_case_fat, aes(ymin = lll, ymax = hhh, y = NULL), alpha = 0.2, size = 1.2, col = &amp;quot;black&amp;quot;)
  
plot_region_case_fatality +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/plot-regional-cfr-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We see that the estimate using mortality rates / incidence rates compares well to the estimate published for 2016 by the WHO, although there is substantial within country variation. For all regions our estimate has substantial uncertainty. The plot suggests that the TB case fatality ratio is decreasing over time in all regions, although this reduction appears to be very minimal in some regions (such as the Americas, Africa, and the Eastern Mediterranean). It is likely that this trend does not hold across all countries, but this is beyond the scope of this post (watch this space).&lt;/p&gt;
&lt;p&gt;As a first look at the case fatality ratios in individual countries we can quickly pull out the 10 countries with the highest case fatality ratio in 2016. These are,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;highest_case_fataltity_countries &amp;lt;- tb_burden %&amp;gt;% 
  filter(year %in% 2016) %&amp;gt;% 
  arrange(desc(cfr)) %&amp;gt;% 
  slice(1:10) %&amp;gt;% 
  pull(country)

highest_case_fataltity_countries&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;Barbados&amp;quot;                    &amp;quot;United Arab Emirates&amp;quot;       
##  [3] &amp;quot;Anguilla&amp;quot;                    &amp;quot;Lesotho&amp;quot;                    
##  [5] &amp;quot;Ghana&amp;quot;                       &amp;quot;Guinea-Bissau&amp;quot;              
##  [7] &amp;quot;Nigeria&amp;quot;                     &amp;quot;United Republic of Tanzania&amp;quot;
##  [9] &amp;quot;Mozambique&amp;quot;                  &amp;quot;Kenya&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can then plot the TB case fatality ratio in these countries, as well as the TB incidence rates over time.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## Plot overview of cases fatality ratios
plot_high_cfr &amp;lt;- plot_tb_burden_overview(metric = &amp;quot;cfr&amp;quot;, 
                                         countries = highest_case_fataltity_countries,
                                         verbose = FALSE) +
  scale_color_viridis(option = &amp;quot;cividis&amp;quot;, direction = -1) +
  theme_ipsum() +
  theme(legend.position = &amp;quot;none&amp;quot;) +
  labs(title = &amp;quot;Tuberculosis Case Fatality Ratio - 2016&amp;quot;,
       subtitle = &amp;quot;For the countries with the 10 highest ratios&amp;quot;)

plot_high_cfr +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/plot-highest-cfr-countries-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_inc_high_cfr &amp;lt;- plot_tb_burden_overview(countries = highest_case_fataltity_countries,
                                             verbose = FALSE) +
  theme(legend.position = &amp;quot;none&amp;quot;) +
  scale_color_viridis(option = &amp;quot;cividis&amp;quot;, direction = -1) +
  theme_ipsum() +
  theme(legend.position = &amp;quot;bottom&amp;quot;) +
  labs(title = &amp;quot;Tuberculosis Incidence Rates - 2000:2016&amp;quot;,
       subtitle = &amp;quot;In the countries with the 10 highest TB case fatality ratios&amp;quot;)

plot_inc_high_cfr +
  labs(caption = &amp;quot;@seabbs Source: WHO&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/plot-inc-rates-high-cfr-1.png&#34; width=&#34;2310&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We see that for some countries on this list (i.e Anguilla, the United Arab Emirates, and Barbados) the high case fatality ratio estimates are likely to be based on a very low sample size and therefore may not be trustworthy. Worryingly however for several countries (Lesotho, Tanzania, Kenya, Mozambique, Guinea-Bissau, and Ghana, and Nigeria) with extremely high case fatality ratios incidence rates are also very high, which will correspond to very high mortality rates. These countries are all in Africa, which as a region also had the highest incidence rates and the highest case fatality ratio. It is clear from these plots that Africa, and these countries in particular should be a particular focus of TB control efforts if TB mortality rates are to be reduced more quickly.&lt;/p&gt;
&lt;p&gt;Finally we summarise this post using &lt;code&gt;patchwork&lt;/code&gt;, a great new package by &lt;a href=&#34;https://twitter.com/thomasp85&#34;&gt;Thomas Pederson&lt;/a&gt;, which lets you easily combine ggplot plots into a single plot. The resulting storyboard (below) neatly summarises the exploratory plots, and the narrative they provide, that we have made in this post. See &lt;a href=&#34;https://www.samabbott.co.uk/post/2018-02-27-estimate-case-fatality-rate_files/figure-html/pathwork-storyboard-1.png&#34;&gt;here&lt;/a&gt; for a full size version.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;storyboard &amp;lt;- (mp1 | mp2 ) /
    {
      plot_region_case_fatality + {
        plot_high_cfr +
          plot_inc_high_cfr +
          labs(caption = &amp;quot;@seabbs Source: World Health Organisation&amp;quot;) +
          plot_layout(ncol = 1)
      } +
        plot_layout(ncol = 2, widths = c(3, 1))
    } +
  plot_layout(ncol = 1, heights = c(2, 4))

ggsave(&amp;quot;../../static/img/getTBinR/storyboard_tb_case_fatality_rate.png&amp;quot;,
       storyboard, width = 20, height = 15, dpi = 330)

storyboard&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-02-27-estimate-case-fatality-rate_files/figure-html/pathwork-storyboard-1.png&#34; width=&#34;7920&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The WHO TB data contains many more variables not mentioned in this post and getTBinR contains additional features, see the &lt;a href=&#34;https://www.samabbott.co.uk/getTBinR/&#34;&gt;site for getTBinR&lt;/a&gt; for details. See &lt;a href=&#34;https://gist.github.com/seabbs&#34;&gt;my gists&lt;/a&gt; for code snippets to get you started in exploring the data further. Package feature requests are welcome, preferably by filing a &lt;a href=&#34;https://github.com/seabbs/getTBinR/issues&#34;&gt;GitHub issue&lt;/a&gt;, as are suggestions for additional data sources to include.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Explore Global Tuberculosis</title>
      <link>http://www.samabbott.co.uk/project/exploreglobaltb/</link>
      <pubDate>Fri, 26 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/exploreglobaltb/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Explore Infectious Disease Models</title>
      <link>http://www.samabbott.co.uk/project/exploreidmodels/</link>
      <pubDate>Mon, 15 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/exploreidmodels/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Exploring Global Trends in Tuberculosis Incidence Rates - with GetTBinR</title>
      <link>http://www.samabbott.co.uk/post/intro-gettbinr/</link>
      <pubDate>Mon, 15 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/intro-gettbinr/</guid>
      <description>&lt;p&gt;In November I attended &lt;a href=&#34;https://www.elsevier.com/events/conferences/international-conference-on-infectious-disease-dynamics&#34;&gt;Epidemics&lt;/a&gt;, which is a conference focused on modelling infectious diseases. There was a lot of great work and perhaps most excitingly a lot of work being offered as R packages.&lt;/p&gt;
&lt;p&gt;I’ve recently begun wrapping all my analytical work in R packages, as it makes producing reproducible research a breeze! Unfortunately all of this work is still making it’s way towards publication and for a variety of reasons can’t be shared until it has passed this hurdle. As I didn’t want to be left out my only alternative was to produce an R package during my downtime at the conference - from which &lt;a href=&#34;https://www.samabbott.co.uk/getTBinR&#34;&gt;getTBinR&lt;/a&gt; was born. Over the Christmas period more work has been done and the package is now available from &lt;a href=&#34;https://cran.r-project.org/web/packages/getTBinR/index.html&#34;&gt;CRAN&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;GetTBinR wraps the World Health Organisation &lt;a href=&#34;http://www.who.int/tb/country/data/download/en/&#34;&gt;Tuberculosis data&lt;/a&gt;, which includes data on Tuberculosis incidence rates, mortality rates, case reporting rates and several other metrics by country from 2000 until 2016 with varying levels of completeness. It also provides some general purpose functions for mapping and plotting the data, with the aim of kick starting any exploratory analysis of the WHO Tuberculosis data.&lt;/p&gt;
&lt;p&gt;For this post I will be quickly diving into global trends in Tuberculosis incidence rates and exploring whether Tuberculosis eradication is on the horizon.&lt;/p&gt;
&lt;p&gt;Now to get started, the first step is to get the package (for this post we are using the development version from GitHub) and to load the other packages required for this analysis.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;install.packages(&amp;quot;devtools&amp;quot;)
devtools::install_github(&amp;quot;seabbs/GetTBinR&amp;quot;)
library(getTBinR)
install.packages(&amp;quot;tidyverse&amp;quot;)
library(tidyverse)
install.packages(&amp;quot;viridis&amp;quot;)
library(viridis)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The package is loaded, time to get the data. We download both the data itself and it’s accompanying data dictionary.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tb_burden &amp;lt;- get_tb_burden(download_data = TRUE, save = TRUE)
dict &amp;lt;- get_data_dict(download_data = TRUE, save = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We want to explore incidence rates so we need to find them in the data. We can do this using the &lt;code&gt;getTBinR::search_data_dict&lt;/code&gt; function,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;search_data_dict(dict = dict, def = &amp;quot;incidence&amp;quot;, verbose = FALSE) %&amp;gt;% 
  knitr::kable()&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;left&#34;&gt;variable_name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;dataset&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;code_list&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;definition&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_100k&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence (all forms) per 100 000 population&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_100k_hi&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence (all forms) per 100 000 population, high bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_100k_lo&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence (all forms) per 100 000 population, low bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_rr_num&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of rifampicin resistant TB (absolute number)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_rr_num_hi&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of rifampicin resistant TB (absolute number): high bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_rr_num_lo&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of rifampicin resistant TB (absolute number): low bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_100k&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive per 100 000 population&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_100k_hi&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive per 100 000 population, high bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_100k_lo&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive per 100 000 population, low bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_num&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_num_hi&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive, high bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;e_inc_tbhiv_num_lo&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimated incidence of TB cases who are HIV-positive, low bound&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The first hit, &lt;code&gt;e_inc_100k&lt;/code&gt;, is the TB incidence rate, with the next two variables being the lower and upper bounds of this estimate. For a quick overview lets map country specific incidence rates in 2016 using the getTBinR function &lt;code&gt;map_tb_burden&lt;/code&gt;,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;map_tb_burden(df = tb_burden, dict = dict,
              metric = &amp;quot;e_inc_100k&amp;quot;, verbose = FALSE) +
  labs(title = &amp;quot;Map of Global Tuberculosis Incidence Rates - 2016&amp;quot;,
       subtitle = &amp;quot;&amp;quot;, caption = &amp;quot;Source: World Health Organisation&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/map-tb-2016-inc-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This shows that incidence rates are highly heterogeneous between regions. To get an better understanding of this lets plot incidence rates by WHO region,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tb_inc_region &amp;lt;- tb_burden %&amp;gt;% 
  group_by(year, g_whoregion) %&amp;gt;% 
  summarise_at(.vars = vars(e_inc_num, e_inc_num_lo, e_inc_num_hi, e_pop_num),
               .funs = funs(sum(as.numeric(.), na.rm = T))) %&amp;gt;% 
  mutate_at(.vars = vars(e_inc_num, e_inc_num_lo, e_inc_num_hi),
            .funs = funs(inc_rate = . / e_pop_num * 1e5)) %&amp;gt;% 
  mutate(g_whoregion = ifelse(is.na(g_whoregion), &amp;quot;Asia&amp;quot;, g_whoregion))

plot_tb_inc_region &amp;lt;- function(df = NULL, title = NULL, subtitle = NULL, scales = NULL) {
  df %&amp;gt;% 
      ggplot(aes(x = year, y = e_inc_num_inc_rate, col = g_whoregion)) +
  geom_point() +
  geom_linerange(aes(ymin = e_inc_num_lo_inc_rate, ymax = e_inc_num_hi_inc_rate)) +
  geom_line() +
  scale_colour_viridis(discrete = TRUE) +
  labs(title = title, subtitle = subtitle, 
       x = &amp;quot;Year&amp;quot;, y = &amp;quot;Tuberculosis Incidence Rates (per 100,000 population)&amp;quot;,
       caption = &amp;quot;Source: World Health Organisation&amp;quot;) +
  theme_minimal() +
  theme(legend.position = &amp;quot;none&amp;quot;) +
  facet_wrap(~g_whoregion, scales = scales)
}

tb_inc_region %&amp;gt;% 
  plot_tb_inc_region(title = &amp;quot;Global Tuberculosis Incidence Rates&amp;quot;,
                     subtitle = &amp;quot;By WHO region, with a fixed y axis&amp;quot;,
                     scales = &amp;quot;fixed&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/plot-region-tb-inc-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We see that incidence rates are much higher in Africa, and in Asia, than in other regions, and that incidence rates in the Americas and Europe are the lowest. This chart has a fixed y axis which makes it hard to see trends over time within regions, if we repeat it with a free y axis the trends over time become more apparent,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tb_inc_region %&amp;gt;% 
  plot_tb_inc_region(title = &amp;quot;Global Tuberculosis Incidence Rates&amp;quot;,
                     subtitle = &amp;quot;By WHO region, with a variable y axis&amp;quot;,
                     scales = &amp;quot;free_y&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/plot-region-tb-inc-free-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;This plot shows that Tuberculosis incidence rates are decreasing in all regions, which is a great sign for the elimination of Tuberculosis. However whilst this is true on the regional level it may not be true for all countries in the data set, something that is required to truly eradicate Tuberculosis. To explore this we find the countries that had higher incidence rates in 2016 than in 2000.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;countries_inc_up &amp;lt;- tb_burden %&amp;gt;% 
  filter(year %in% c(2000, 2016)) %&amp;gt;% 
  group_by(country) %&amp;gt;% 
  arrange(desc(e_inc_100k)) %&amp;gt;% 
  slice(1) %&amp;gt;% 
  filter(year == 2016) %&amp;gt;% 
  pull(country)

high_inc_countries &amp;lt;- tb_burden %&amp;gt;% 
  filter(year == 2016) %&amp;gt;% 
  group_by(country) %&amp;gt;% 
  summarise(e_inc_100k = max(e_inc_100k)) %&amp;gt;% 
  ungroup %&amp;gt;% 
  arrange(desc(e_inc_100k)) %&amp;gt;% 
  slice(1:20) %&amp;gt;% 
  pull(country) %&amp;gt;% 
  unique

high_inc_up_countries &amp;lt;- intersect(countries_inc_up, high_inc_countries)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This results in a list of 44 countries all of which had higher incidence rates in 2016 than in 2000. Of these countries 8 were in the top 20 countries by incidence rate in 2016. This can plotted below using &lt;code&gt;getTBinR::plot_tb_burden_overview&lt;/code&gt;,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_tb_burden_overview(df = tb_burden,
                        dict = dict, 
                        metric = &amp;quot;e_inc_100k&amp;quot;, 
                        countries = high_inc_up_countries,
                        verbose = FALSE) +
  labs(title = &amp;quot;Tuberculosis Incidence Rates from 2000-2016&amp;quot;,
       subtitle = &amp;quot;Showing countries with the highest incidence rates in which incidence rates are increasing&amp;quot;,
       caption = &amp;quot;Source: World Health Organisation&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/plot-tb-inc-high-inc-overview-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;GetTBinR also supplies another function (&lt;code&gt;plot_tb_burden&lt;/code&gt;) that can be used to visualise this,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_tb_burden(df = tb_burden,
               dict = dict,
               metric = &amp;quot;e_inc_100k&amp;quot;, countries = high_inc_up_countries, 
               facet = &amp;quot;country&amp;quot;, scales = &amp;quot;free_y&amp;quot;, verbose = FALSE) +
  labs(title = &amp;quot;Tuberculosis Incidence Rates from 2000-2016&amp;quot;,
       subtitle = &amp;quot;Showing countries with the highest incidence rates in which incidence rates are increasing&amp;quot;,
       caption = &amp;quot;Source: World Health Organisation&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/plot-tb-inc-high-inc-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;A possible cause of this may be that reporting of Tuberculosis notifications has improved over time, to understand this we first find the required variable in the data,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;search_data_dict(dict = dict, def = &amp;quot;detection&amp;quot;, verbose = FALSE) %&amp;gt;% 
  knitr::kable()&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;left&#34;&gt;variable_name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;dataset&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;code_list&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;definition&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;c_cdr&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Case detection rate (all forms), percent&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;c_cdr_hi&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Case detection rate (all forms), percent, high bound&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;c_cdr_lo&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estimates&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Case detection rate (all forms), percent, low bound&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We then plot the case detection rate over time in the countries of interest,&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_tb_burden(df = tb_burden,
               dict = dict,
               metric = &amp;quot;c_cdr&amp;quot;, countries = high_inc_up_countries, 
               facet = &amp;quot;country&amp;quot;, scales = &amp;quot;free_y&amp;quot;, verbose = FALSE) +
  labs(title = &amp;quot;Tuberculosis Detection Rates from 2000-2016&amp;quot;,
       subtitle = &amp;quot;Showing countries with the highest incidence rates in which incidence rates are increasing&amp;quot;,
       caption = &amp;quot;Source: World Health Organisation&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;./post/2018-01-15-intro-tb-getTBinR_files/figure-html/plot-tb-inc-high-case-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The plot above shows that for some countries such as Mozambique and South Africa the increases in incidence rates may be linked to increases in the cases detection rate. However, it is clear that this is not the case for all countries, in particular the Congo which has seen increasing incidence rates and falling case detection rates.&lt;/p&gt;
&lt;p&gt;This post has highlighted the fact that whilst Tuberculosis is declining globally this is not the case in all countries. In order for the global eradication of Tuberculosis to be a success it is vital that resources are targeted at those countries which are struggling to reduce their incidence rates.&lt;/p&gt;
&lt;p&gt;The WHO Tuberculosis data contains many variables not mentioned in this post and has the potential to answer a number of other questions. See the &lt;a href=&#34;https://www.samabbott.co.uk/getTBinR/&#34;&gt;package site&lt;/a&gt; for additional package features not mentioned in this post. See &lt;a href=&#34;https://gist.github.com/seabbs&#34;&gt;my gists&lt;/a&gt; for code snippets to get you started. Feature requests are welcome, preferably by filing a &lt;a href=&#34;https://github.com/seabbs/getTBinR/issues&#34;&gt;GitHub issue&lt;/a&gt;, as are suggestions for additional data sources to include.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Show Me Perseus</title>
      <link>http://www.samabbott.co.uk/project/showmeperseus/</link>
      <pubDate>Mon, 15 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/showmeperseus/</guid>
      <description></description>
    </item>
    
    <item>
      <title>getTBinR</title>
      <link>http://www.samabbott.co.uk/project/gettbinr/</link>
      <pubDate>Thu, 30 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/gettbinr/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Tuberculosis Incidence and Interventions in England and Wales, 1913-2016</title>
      <link>http://www.samabbott.co.uk/post/tb-england-wales/</link>
      <pubDate>Sun, 29 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/tb-england-wales/</guid>
      <description>&lt;p&gt;This interactive dashboard uses data on Tuberculosis incidence from 1913-1916 &lt;a href=&#34;https://www.gov.uk/government/publications/tuberculosis-tb-annual-notifications-1913-onwards&#34;&gt;released&lt;/a&gt; by Public Health England and combines it with data on the interventions against Tuberculosis that have been discovered/implemented over the last century. The data was cleaned and imported into R using the &lt;a href=&#34;https://www.samabbott.co.uk/tbinenglanddataclean/&#34;&gt;tbinenglanddataclean&lt;/a&gt; R package, which also contains information on how to apply for additional data, scripts to clean data extracts and graphing functions to visualise them. The dashboard is a work in progress and additional interventions, new figures and increased interactivity will be added over time. For a full page view of the dashboard see &lt;a href=&#34;http://www.seabbs.co.uk/shiny/TB_England_Wales&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src=&#34;http://www.seabbs.co.uk/shiny/TB_England_Wales?showcase=0&#34; width=&#34;672&#34; height=&#34;2000px&#34;&gt;
&lt;/iframe&gt;
</description>
    </item>
    
    <item>
      <title>Introduction to TB Modelling</title>
      <link>http://www.samabbott.co.uk/project/intro_tb_models/</link>
      <pubDate>Thu, 12 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/intro_tb_models/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Tuberculosis in England and Wales</title>
      <link>http://www.samabbott.co.uk/project/tb_england_wales/</link>
      <pubDate>Thu, 12 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/tb_england_wales/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Beneficial effects of BCG vaccination in outcomes for patients diagnosed with TB: observational study using the Enhanced Tuberculosis surveillance system 2009-2015</title>
      <link>http://www.samabbott.co.uk/talk/union-2017/</link>
      <pubDate>Wed, 11 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/talk/union-2017/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Deep Dive; Premiums on Valuation in the Property Partner Portfolio</title>
      <link>http://www.samabbott.co.uk/post/deep-dive-pp-premiums/</link>
      <pubDate>Tue, 26 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/deep-dive-pp-premiums/</guid>
      <description>&lt;p&gt;Previously I have looked at visualising the &lt;a href=&#34;https://www.propertypartner.co/aboutus#/ourstory&#34; target=&#34;_blank&#34;&gt;Property Partner&lt;/a&gt; portfolio using &lt;a href=&#34;https://public.tableau.com/views/PropertyPartnerPortfolioVisualisation/PropertyPartnerPortfolio?:embed=y&amp;amp;:display_count=yes&#34; target=&#34;_blank&#34;&gt;tableau&lt;/a&gt;, and &lt;a href=&#34;https://www.samabbott.co.uk/post/deep-dive-pp-open-house/&#34; target=&#34;_blank&#34;&gt;explored their resale date from July 2017&lt;/a&gt;. In this post I will be exploring the &lt;a href=&#34;https://resources.propertypartner.co/open-house-august-2017/&#34; target=&#34;_blank&#34;&gt;August Open House resale&lt;/a&gt; data focussing on property premiums over both initial and latest valuation. The code for this post is available &lt;a href=&#34;https://github.com/seabbs/propertypartner/blob/master/report/17-09-18-premium/latest_initial_premium.Rmd&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Property Partner advertises returns by combining both projected capital and rental returns. Properties are held for 5 years at which point any capital gain can be realised. However, Property Partner provides a secondary market which allows capital returns to be realised by selling shares to other investors. The sale price of shares is set by the market, and may or may not depend on the underlying value of the property. This post will explore the premium that sales on the secondary market set on both the initial and latest valuations of properties in the Property Partner Portfolio, and how this has changed over time. A first step is to look at premiums over time, for each property, averaged over each month (as are all premiums in this post).&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig1.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;From the above plot we see that in the first year of operation all properties had premiums above 0% over initial valuation, but since then several have traded with premiums that are continuously negative. The majority of these properties have maintained steady premiums over initial valuation but several devalued in the second half of 2017. A single property (5 flats, Dutch Quarter, Colchester) has consistently traded with a negative premium although this appears to be improving over time.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig2.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;Unlike premiums over initial valuation, premiums over latest valuation appear to have decreased continuously over time for the majority of properties. This indicates that premiums are not completely adjusting for increases in property value, making it unlikely that those exiting early will fully realise capital gains. Both plots indicate a relationship between premiums and the date a property was made available for resale, with properties available earlier having higher premiums over both initial and latest valuation. The above plots are hard to interpret due to the number of properties in the portfolio, therefore the next step is to summarise the data by averaging premiums across all properties.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig3.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;As we saw in the previous plots premiums over both initial and latest valuation were highest in 2015 and have since decreased. Since 2016 premiums over initial valuation appear to have stabilised between 5% to 10% and premiums over latest valuation appear to have stabilised between 0% to -8%. The relationship between premiums over latest and initial valuation is summarised in the following plot.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig4.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;In the plots above there was some evidence that properties acquired at different dates traded differently. To investigate this the following plot shows the average monthly premium for properties launched in each year Property Partner has been operating, for both initial and latest valuation.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig5.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;We see that properties acquired earlier consistently trade at a higher premium over both initial and latest valuation. Whilst the trend in initial valuation may be driven by increased valuation this cannot be the case for latest valuation. Instead, it is likely that this is a function of scarcity due to the lower supply of earlier properties. It may also be the case that previous performance on the platform is valued. This plot also indicates that premiums over latest valuation have constantly fallen for all years. Properties appear to start trading with a slightly positive  premium, which then decreases over time. This indicates that premiums do not adjust fully as properties are revalued, meaning that realising potential capital gains early is unlikely. To explore this further the following plot compares premiums on initial and latest valuations over time, for individual properties.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./post/2017-09-26-deep-dive-pp-premiums/gif1.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;From the plot we see that properties enter the market trading at a small premium to both valuations. Over time the relationship between premiums for initial and latest valuation weakens, with several properties trading at negative premiums for both valuations. To get a better idea of the relationship the following plot stratifies by the year a property was made available for resale.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./post/2017-09-26-deep-dive-pp-premiums/gif2.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Here we clearly see that when properties enter the market there is a strong correlation between premiums on latest and initial valuations. As properties are revalued we see that premiums on latest valuation do not adjust fully, although this effect varies wildly. This is likely to be driven by external factors such as dividend yield - with high dividend yields commanding a premium. The following interactive plot allows the figures above to be explored in detail.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig6.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;For a final visualisation of this relationship the following plot shows premiums for individual properties over time, stratified by year available for resale.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./post/2017-09-26-deep-dive-pp-premiums/gif3.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately this dataset was limited by having little additional information about each property, something which is key to understanding premiums. For example, as commented on above, it is likely that much of the variation is drive by dividend yield. However, it is clear that properties are not valued at their latest valuation and that therefore this should not be used to summarise the performance of a portfolio over the short term.&lt;/p&gt;

&lt;p&gt;In a future post I will be exploring premiums further by joining the resale data used above with data on the Property Partner portfolio. The two datasets do not contain a common unique ID by which to link them, meaning that joining them will be less trivial that it should be. Hopefully Property Partner will improve the quality of the data they provide to investors so that analysis can be done more easily.&lt;/p&gt;

&lt;p&gt;If you have any comments, ideas for further projects, or any similar analysis to share please comment below.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Bonus Plot!!&lt;/strong&gt;&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-26-deep-dive-pp-premiums/fig7.html&#34; width = &#34;100%&#34; height=&#34;1000&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;
</description>
    </item>
    
    <item>
      <title>Deep Dive; Property Partner July 2017 Open House Resale Data</title>
      <link>http://www.samabbott.co.uk/post/deep-dive-pp-open-house/</link>
      <pubDate>Fri, 15 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/deep-dive-pp-open-house/</guid>
      <description>&lt;p&gt;As peer to peer lending matures platforms have begun to have increasingly divergent stances on sharing their data, making it increasingly important that their is external pressure on them to improve their data sharing. This blog series will focus on platforms sharing their data, exploring what their data is saying and suggesting possible changes to their releases that would make it easier for investors to gain insights on their own.&lt;/p&gt;

&lt;p&gt;For the first post I will be focussing on data from &lt;a href=&#34;https://www.propertypartner.co/aboutus#/ourstory&#34; target=&#34;_blank&#34;&gt;Property Partner&lt;/a&gt;, which is a property crowd-funding site that started in 2014 and allows investors to buy small stakes in a range of properties. The data I will be using was released as part of Property Partner&amp;rsquo;s &lt;a href=&#34;https://resources.propertypartner.co/open-house-july-2017/&#34; target=&#34;_blank&#34;&gt;July 2017 open house data&lt;/a&gt; blog, and contains information on resale&amp;rsquo;s of their property portfolio. This post will reproduce and update previous work, explore the underlying trends, and suggest possible changes for future releases. All code is available &lt;a href=&#34;https://github.com/seabbs/propertypartner&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt; and the data can be downloaded from this &lt;a href=&#34;https://d2ofd11qqzygs0.cloudfront.net/files/purchases-on-resale-july-2017-open-house.zip&#34; target=&#34;_blank&#34;&gt;link&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As a starting point I have reproduced a graph of Transactions (£) over time first published &lt;a href=&#34;https://p2pblog.co.uk/property-partner-trading-analysis/&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;. This shows the increase in transactions (£) over time on the resale market, with a continuous increase in volume until early 2016 from which point seasonal variation has dominated. I have also stratified by transaction type, revealing the impact of the recently introduced bidding system, which has steadily increased it&amp;rsquo;s share of transactions month on month.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig1.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;The plot naturally leads to the following question - is the increase in trading volume driven by an increasing number of trades or by changes in the size of trades being made? The following plot explores this by plotting the number of transactions over time. We see that the early growth in volumes was likely driven by an increasing number of trades but that variation since then is more strongly linked to changes in trade size.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig2.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;Now that we understand how transactions (N) have varied with time we need to explore the underlying trends. The most obvious question is which properties are being traded for the most, and if possible why do these properties have so much turn over? The following plot shows trades by property, stratified by year. For the first year of trading we see that a few properties (as the portfolio was small) dominated the number of trades made. In 2016 trading was spread over more properties but with fewer trades per property. So far for 2017 there has been a greatly reduced number of trades, with trading becoming increasingly homogeneous across the  portfolio. Unfortunately the extract published by Property Partner has little detail about properties so establishing why properties are traded at different rates is difficult. Whilst I could in principle join the various data sets they produce, without a unique ID this would be difficult and prone to errors!&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig3.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;As the number of transactions is relatively stable, but the volume of transactions has increased, therefore size of transactions must have changed over time. To explore this I have plotted transactions (£) over time stratified by binned transaction size. As transaction size increases there is greater seasonal variation, which indicates that both large and small traders are key drivers of Property Partner&amp;rsquo;s trading volume with larger trades providing the year on year growth and smaller trades acting to smooth seasonal variability. Since January 2016 there has been little growth in small trades, with larger trades becoming increasingly common. However, the largest trades (£5,000-£49,999) peaked in early 2016 since when they have been decreasing year on year (although this trend is obscured by seasonal variation).&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig4.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;Whilst the binned transaction sizes used above were helpful in quickly visualising the changes transactions (£) by size they are arbitrary and may be obscuring underlying changes. The following plot explores this by plotting the distribution of transactions sizes within each binned transaction size. This plot contains a large amount of condensed information, the salient points are that mid-size trades (£100-£499) have shifted from being primary around £200 to being relatively equally distributed across the range, large trades (£500-£999) have become increasingly bi-model, and very high value transactions (£20,000+) have become more common as a subset of high value transactions (£5,000-£49,999).&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./post/2017-09-15-deep-dive-pp-open-house/figure-html/trans-size-1.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;p&gt;Another approach to visualising changing transaction size over time, is to plot the proportion of trades (by number) for each binned transaction size. As indicated in the previous plots, this shows that larger trades have become increasingly common, with the large trades (£1000-£4,999) increasing to 2% of manual trades, and  5% of matched bids in 2017. The most common trade size is still small (£1-£99), but the proportion of very small trades  (£0-£1) has drastically reduced. Matched bids are more likely to be larger transactions with small trades (£1-£99) making up 54% of transactions compared to 68% of manual orders.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig5.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;The data released by Property Partner also contains information about the unit price each transaction was made at, and what premium this was against both the latest and original valuation. As this data is provided across all properties in the portfolio a single visualisation of the data may not indicate the underling relationship. A first step is to plot the monthly average (weighted by transaction size) premium on latest valuation for each property in the portfolio, by comparing premiums on latest valuation rather than raw share price properties can be compared against each other. This plot indicates a general
downward trend in premiums but is difficult to interpret due to the number of properties in the portfolio.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig6.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;To explore this apparent trend a first step is to look at the trends in premiums across the Property Partner portfolio, using the mean premium across all properties. This indicates that premiums were originally high but have decreased over time, and since the beginning of 2016 have been negative on average. As with transactions (£) seasonal dynamics now appear to dominate with premiums being relatively stable year on year.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig7.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;As we have averaged across all properties in the Property Partner portfolio the relationship we have identified between year and premium may be confounded by a variety of factors. An obvious question is whether the quality of property purchased by Property Partner has changed over time (if we assume that premium over latest valuation is a good proxy of property quality). The plot below looks at the average weighted premium for properties made available for resale in each year (this is confounded by the rate properties are made available in a given year). From this plot we see that across all years of trading (except 2014) properties start with a small positive premium, which then gradually declines with time. Properties from 2014 have bucked this trend, which is likely due to the novelty of owning a property from the early days of Property Partner. Properties from 2015 have a linear relationship between premium and time, trading increasingly below their valuation. Properties from 2016 suffered a rapid reduction in premium, indicating a possible reduction in property quality, although this has now stabilised. So far properties from 2017 have held positive premiums, with little reduction over time.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig8.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;As a final plot for this blog post I have reproduced another plot from &lt;a href=&#34;https://p2pblog.co.uk/property-partner-trading-analysis/&#34; target=&#34;_blank&#34;&gt;this post&lt;/a&gt; (from the &lt;a href=&#34;https://p2pblog.co.uk/&#34; target=&#34;_blank&#34;&gt;p2pblog.co.uk&lt;/a&gt;), which is well worth a read.&lt;/p&gt;

&lt;iframe seamless src=&#34;../../post/2017-09-15-deep-dive-pp-open-house/fig9.html&#34; width = &#34;100%&#34; height=&#34;500&#34; id=&#34;iframe_container&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;To see the current state of the Property Partner Portfolio you can explore for youself &lt;a href=&#34;https://public.tableau.com/views/PropertyPartnerPortfolioVisualisation/PropertyPartnerPortfolio?:embed=y&amp;amp;:display_count=yes&#34; target=&#34;_blank&#34;&gt;using this Tableau dashboard.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;div class=&#39;tableauPlaceholder&#39; id=&#39;viz1505484367745&#39; style=&#39;position: relative&#39;&gt;&lt;noscript&gt;&lt;a href=&#39;#&#39;&gt;&lt;img alt=&#39;Property Partner Portfolio &#39; src=&#39;https:&amp;#47;&amp;#47;public.tableau.com&amp;#47;static&amp;#47;images&amp;#47;Pr&amp;#47;PropertyPartnerPortfolioVisualisation&amp;#47;PropertyPartnerPortfolio&amp;#47;1_rss.png&#39; style=&#39;border: none&#39; /&gt;&lt;/a&gt;&lt;/noscript&gt;&lt;object class=&#39;tableauViz&#39;  style=&#39;display:none;&#39;&gt;&lt;param name=&#39;host_url&#39; value=&#39;https%3A%2F%2Fpublic.tableau.com%2F&#39; /&gt; &lt;param name=&#39;site_root&#39; value=&#39;&#39; /&gt;&lt;param name=&#39;name&#39; value=&#39;PropertyPartnerPortfolioVisualisation&amp;#47;PropertyPartnerPortfolio&#39; /&gt;&lt;param name=&#39;tabs&#39; value=&#39;no&#39; /&gt;&lt;param name=&#39;toolbar&#39; value=&#39;yes&#39; /&gt;&lt;param name=&#39;static_image&#39; value=&#39;https:&amp;#47;&amp;#47;public.tableau.com&amp;#47;static&amp;#47;images&amp;#47;Pr&amp;#47;PropertyPartnerPortfolioVisualisation&amp;#47;PropertyPartnerPortfolio&amp;#47;1.png&#39; /&gt; &lt;param name=&#39;animate_transition&#39; value=&#39;yes&#39; /&gt;&lt;param name=&#39;display_static_image&#39; value=&#39;yes&#39; /&gt;&lt;param name=&#39;display_spinner&#39; value=&#39;yes&#39; /&gt;&lt;param name=&#39;display_overlay&#39; value=&#39;yes&#39; /&gt;&lt;param name=&#39;display_count&#39; value=&#39;yes&#39; /&gt;&lt;/object&gt;&lt;/div&gt;                &lt;script type=&#39;text/javascript&#39;&gt;                    var divElement = document.getElementById(&amp;lsquo;viz1505484367745&amp;rsquo;);                    var vizElement = divElement.getElementsByTagName(&amp;lsquo;object&amp;rsquo;)[0];                    vizElement.style.width=&amp;lsquo;100%&amp;rsquo;;vizElement.style.height=(divElement.offsetWidth*0.75)+&amp;lsquo;px&amp;rsquo;;                    var scriptElement = document.createElement(&amp;lsquo;script&amp;rsquo;);                    scriptElement.src = &amp;lsquo;&lt;a href=&#34;https://public.tableau.com/javascripts/api/viz_v1.js&#39;&#34; target=&#34;_blank&#34;&gt;https://public.tableau.com/javascripts/api/viz_v1.js&#39;&lt;/a&gt;;                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                &lt;/script&gt;&lt;/p&gt;

&lt;p&gt;As a final note whilst it is great that Property Partner releases data this analysis was limited by the quality of the data published. If their is interest in more of these deep data dives then I would suggest contacting the peer to peer platforms that you invest in and asking that a live data extract be made available, without a login or extensive user agreement. This would ideally contain a unique ID for each loan/property etc, information on both primary and secondary market transactions, and metadata about each loan/property; such as location, type, value, etc. If you want to know more about analysis ready data then see &lt;a href=&#34;http://vita.had.co.nz/papers/tidy-data.html&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Property Partner Portfolio Visualisation</title>
      <link>http://www.samabbott.co.uk/project/propertypartner_tableau/</link>
      <pubDate>Thu, 14 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/project/propertypartner_tableau/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Introducing the Pebble Game; a simple app for exploring epidemics and vaccination</title>
      <link>http://www.samabbott.co.uk/post/using-the-pebble-game/</link>
      <pubDate>Tue, 15 Aug 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/post/using-the-pebble-game/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://seabbs.co.uk/shiny/thepebblegame&#34; target=&#34;_blank&#34;&gt;The Pebble Game&lt;/a&gt; is a shiny application that simulates a simple game which has been designed  to reflect real world epidemics and the vaccination programmes used to control them. It involves repeatedly drawing pebbles from a bag, which contains two distinct pebble types (to represent vaccinated and unvaccinated individuals). The number of pebbles that are drawn each round is dependent on the number of infect-able (i.e unvaccinated) cases drawn in the previous round, and the infectiousness of the simulated disease. Each game can then be thought of as a single stochastic (with a random element) epidemic, by combining multiple simulations of the game, the dynamics of the system can be understood. Hopefully by playing the game and exploring the app you will gain an insight into how a single vaccination can contribute to protecting the rest of society.&lt;/p&gt;

&lt;h2 id=&#34;playing-a-single-game&#34;&gt;Playing a single game&lt;/h2&gt;

&lt;p&gt;The first step is to understand what is being simulated, hopefully if you have just played the game with me in person you should have a good idea of this! If you haven&amp;rsquo;t played the game with me, and the simple explanation above wasn&amp;rsquo;t enough then see the instructions for &lt;a href=&#34;http://www.seabbs.co.uk/shiny/thepebblegame&#34; target=&#34;_blank&#34;&gt;playing the game physcially&lt;/a&gt; (click on the how to play the game tab)- it might even be worth giving it a go at home.&lt;/p&gt;

&lt;p&gt;The next step is to &lt;a href=&#34;http://www.seabbs.co.uk/shiny/thepebblegame&#34; target=&#34;_blank&#34;&gt;open the app&lt;/a&gt;. Your screen should then look like this,&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./img/single_game.png&#34; alt=&#34;The game simulation tab from the pebble game app&#34; /&gt;&lt;/p&gt;

&lt;p&gt;You should now be looking at 10 simulations of the pebble game, each with 100 pebbles, 60% of pebbles being vaccinated, and a &lt;a href=&#34;https://en.wikipedia.org/wiki/Basic_reproduction_number&#34; target=&#34;_blank&#34;&gt;reproduction number&lt;/a&gt; of 3 (don&amp;rsquo;t know what this is - try hovering over it in the app). These parameters can all be varied (hit the plus in the game parameters box), although if you add more stones or more simulations it may take awhile!&lt;/p&gt;

&lt;p&gt;The graph on the right summarises each simulation, recording the number of pebbles in each generation. You should notice that some paths are darker blue than others, this indicates that multiple simulations traced the same pathway. From this you should see that there are two distinct solutions, a rapid die out of the disease or an epidemic that infects everyone (try varying the parameters to see what effects they have on these &lt;a href=&#34;https://en.wikipedia.org/wiki/Steady_state&#34; target=&#34;_blank&#34;&gt;steady states&lt;/a&gt;). To get a clearer picture of this try setting the summary statistic to plot to the number of pebbles, this will show how the disease spreads with each generation (known as the epidemic curve).&lt;/p&gt;

&lt;p&gt;The dark blue line, and shaded ribbon, summarise all your simulations (using the &lt;a href=&#34;https://en.wikipedia.org/wiki/Mean&#34; target=&#34;_blank&#34;&gt;mean&lt;/a&gt; and &lt;a href=&#34;https://en.wikipedia.org/wiki/Confidence_interval&#34; target=&#34;_blank&#34;&gt;95% confidence intervals&lt;/a&gt;), whilst this is helpful it doesn&amp;rsquo;t always tell the full story! This is because if you have diverging solutions, as in this example, a single summary statistic cannot accurately represent either of them and instead represents an overview of the system. This is a well known problem in statistics so watch out for it cropping up elsewhere.&lt;/p&gt;

&lt;p&gt;The table below the graph helps with this problem by providing a variety of summary measures, including the number in each generation, the number of generations, the total number infected, and the percentage of unvaccinated pebbles  that are infected. Each one of these is presented with several measures (mean, median, 25%, and 75% quantiles), this allows you to get an understanding of the distribution (which you can&amp;rsquo;t get from a single point estimate). In this example you should see that mean number of generations is about 7, which parameters effect this measure? Can you vary the parameters so that the mean is still about 7 but the other summary measures change?&lt;/p&gt;

&lt;p&gt;Now it is time to investigate an epidemic using the app. A common goal of vaccination programmes is to vaccinate a sufficient proportion of the population that a disease cannot cause an epidemic. The lower bound for this is known as the &lt;a href=&#34;https://en.wikipedia.org/wiki/Herd_immunity&#34; target=&#34;_blank&#34;&gt;vaccination thresold&lt;/a&gt;, which can often be found mathematically. By varying the parameters of the game you should be able to estimate this threshold! The key question is now what factors influence this vaccination threshold (try varying the game parameters)? Once you&amp;rsquo;ve investigated all the parameters try looking up some real world diseases (for example &lt;a href=&#34;https://blogs.scientificamerican.com/roots-of-unity/understand-the-measles-outbreak-with-this-one-weird-number/&#34; target=&#34;_blank&#34;&gt;measles&lt;/a&gt;) and seeing how the vaccination threshold of your disease compares to theirs. Why do you think it is different?&lt;/p&gt;

&lt;h2 id=&#34;comparing-diseases&#34;&gt;Comparing diseases&lt;/h2&gt;

&lt;p&gt;To help you further explore the effects of varying parameters on the outcome of the pebble game &lt;a href=&#34;http://www.seabbs.co.uk/shiny/thepebblegame&#34; target=&#34;_blank&#34;&gt;the Pebble Game app&lt;/a&gt; has an additional tab (Compare diseases). This lets you simulate two diseases, each with an individual reproduction number, but otherwise using the same parameters. An example, comparing a disease with a reproduction number of 3 and another disease with a reproduction number of 12 can be seen below,&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;./img/compare_game.png&#34; alt=&#34;The disease comparision tab from the pebble game app&#34; /&gt;&lt;/p&gt;

&lt;p&gt;The output in this tab is very similar to that in the Play the game tab, but there is now a graph of both diseases, as well as for each disease separately. In this example we see that the second disease has a much lower generation time, than the primary disease. However even for this much slower disease in over 25% of simulations all of the unvaccinated pebbles are still infected!&lt;/p&gt;

&lt;h2 id=&#34;ideas-for-further-exploration&#34;&gt;Ideas for further exploration&lt;/h2&gt;

&lt;p&gt;If you are interested in exploring the pebble game further then here are a few ideas of what to questions to investigate;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;What effect does varying the number of simulations have? Are there parameters for which this has a greater impact? If so what implications does this have for real world diseases?&lt;/li&gt;
&lt;li&gt;Can you identify stages of an epidemic by looking at plots of the number of pebbles  in each generation? At which stage is the disease most likely to die out? What does this mean for epidemic control?&lt;/li&gt;
&lt;li&gt;What features of epidemics is the Pebble Game not capturing? How do you think these features might influence the results?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hopefully this post was a useful introduction to the Pebble Game and to the simple dynamics of infectious disease dynamics and vaccination. If you have any suggests for another blog post, or future developments to the Pebble Game then please comment below or contact me by &lt;a href=&#34;https://twitter.com/seabbs&#34; target=&#34;_blank&#34;&gt;twitter&lt;/a&gt; or &lt;a href=&#34;https://www.samabbott.co.uk/#contact&#34; target=&#34;_blank&#34;&gt;email&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Modelling BCG vaccination in the UK: What is the impact of changing vaccination policy?</title>
      <link>http://www.samabbott.co.uk/talk/group_talk_17_08/</link>
      <pubDate>Thu, 03 Aug 2017 00:00:00 +0000</pubDate>
      
      <guid>http://www.samabbott.co.uk/talk/group_talk_17_08/</guid>
      <description></description>
    </item>
    
  </channel>
</rss>
