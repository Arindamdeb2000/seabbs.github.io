<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Rstats on Sam Abbott</title>
    <link>http://samabbott.co.uk/tags/rstats/</link>
    <description>Recent content in Rstats on Sam Abbott</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-uk</language>
    <copyright>&amp;copy; 2016 Sam Abbott</copyright>
    <lastBuildDate>Sat, 10 Jun 2017 00:00:00 +0000</lastBuildDate>
    <atom:link href="/tags/rstats/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>The Pebble Game</title>
      <link>http://samabbott.co.uk/project/thepebblegame/</link>
      <pubDate>Sat, 10 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/project/thepebblegame/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Funding Circle Data Anaylsis</title>
      <link>http://samabbott.co.uk/project/funding-circle/</link>
      <pubDate>Tue, 06 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/project/funding-circle/</guid>
      <description></description>
    </item>
    
    <item>
      <title>prettypublisher</title>
      <link>http://samabbott.co.uk/project/prettypublisher/</link>
      <pubDate>Tue, 06 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/project/prettypublisher/</guid>
      <description></description>
    </item>
    
    <item>
      <title>tbinenglanddataclean</title>
      <link>http://samabbott.co.uk/project/-tbinenglanddataclean/</link>
      <pubDate>Tue, 06 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/project/-tbinenglanddataclean/</guid>
      <description></description>
    </item>
    
    <item>
      <title>The temptation of a long loan; Risk and rewards of term length</title>
      <link>http://samabbott.co.uk/post/temp-long-loan/</link>
      <pubDate>Wed, 08 Mar 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/post/temp-long-loan/</guid>
      <description>&lt;p&gt;As a quick update to last weeks post this week we will be using the estimates of bad debt from last week to assess the true risk/rewards of loans at various lengths from the funding circle (FC) loan book. I realised recently that when picking loans my default criteria tends towards picking loans with the lowest percieved risk (i.e lowest risk band) with the highest interest rates possible. This strategy has some interesting consequences in that it preferentially selects long term loans that tend to have higher rates.&lt;/p&gt;

&lt;p&gt;FC surfaces the average bad debt rate by risk band and not by the term of the loan. Whilst this is a simplifying assumption that makes the investing process easier to understand, for it to be true short term loans must be inherantly riskier than long term loans, or the risk of default must be decoupled from time. Both of these assumptions seem unlikely to me,  and in a later past we will be looking further at the lifecourse of loans, but for this week we will simply be using my function for estimating for bad debt individually for each term length. As discussed last time we estimate the percentage of bad debt by comparing the proportion of bad debt, with total debt, accounting for loan size, the principal remaining, and the interest paid on the loan. This approach also has the same caveats as last time in that it does not account for future recoveries by funding circle, and so becomes increasingly inaccurate for more recent loans.&lt;/p&gt;

&lt;p&gt;We first identify the possible loan terms available to borrowers in the FC ecosystem, and the number in each category. We see that by far the most common loans terms are those, as might be expected, that are an integer number of years. For clarity we restrict ourselves to looking at these most common loans (6, 12, 24, 48, 36, and 60 months), stratifying by risk band.&lt;/p&gt;

&lt;p&gt;Table: Number of loans by loan length across the funding circle loan book&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Term&lt;/th&gt;
&lt;th&gt;Number of loans&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;12916&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;36&lt;/td&gt;
&lt;td&gt;7199&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;48&lt;/td&gt;
&lt;td&gt;2435&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;1959&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;1578&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;244&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;231&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;70&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;55&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;51&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;48&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;45&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;43&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;42&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;37&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/est_bad_rate_risk-1.png&#34; alt=&#34;Estimated bad debt rate, accounting for repayments and the principal remaining, for the 6 most common term lengths straitifed by risk band&#34; /&gt;&lt;/p&gt;

&lt;p&gt;We see that the assumption that short term loans are higher risk is only true for loans of 6 months, and for E loans of 12 months, which have a much greater risk of bad debt than all other loans. However these loans are relatively rare so this may be an artifact of low statistical power. For all other loan lengths we see that the risk of bad debt increases, with time with loans that are 36 months and over accounting for the majority of the bad debt in all risk categories. As I have not accounted for the maturity of loans, this apparent trend may be driven by the differing ages of loans in different years. Therefore we repeat the above but now stratify further by year, dropping loans with 6 month terms for clarity. Whilst this does add some variation the overall trend appears to hold with longer term loans having significantly higher proportions of bad debt, this is particularly true of E loans, where 60 month loans have much higher bad debt rates than those with shorter terms.&lt;/p&gt;

&lt;p&gt;An obvious point to note is that FC adjusts interest rates by term length, so that longer term loans have higher rates, this adjustment is obviously to account for the disparity in risk over loan term. In a follow up post I will be using these estimates of bad debt by loan term to evaluate the return on loans of difffernt term lengths to assess whether these adjustments sufficiently account for the increased risk of longer term loans.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2011-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2011&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2012-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2012&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2013-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2013&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2014-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2014&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2015-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2015&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-temp-long-loan/figure-html/bad_debt_2016-1.png&#34; alt=&#34;Estimated bad debt by term length stratified by risk band, for 2016&#34; /&gt;&lt;/p&gt;

&lt;p&gt;This blog series is bi-weekly, please comment with suggestions of topics. The code for this post can be found at the &lt;a href=&#34;https://github.com/seabbs/funding_circle&#34; target=&#34;_blank&#34;&gt;Github repo&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Visualising the funding circle loanbook</title>
      <link>http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/</link>
      <pubDate>Tue, 17 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/</guid>
      <description>&lt;p&gt;This is the first in a series of blog posts looking at P2P lenders, which will be aimed at surfacing more details about the structures of their loan books. I hope to expand this series by looking at optimal strategies, predictive modelling, and interactive data science.&lt;/p&gt;

&lt;p&gt;Since 2005, with the launch of &lt;a href=&#34;www.zopa.co.uk&#34; target=&#34;_blank&#34;&gt;Zopa&lt;/a&gt; P2P companies have provided a middle path between cash holdings, and investing in stocks and shares. Funding circle, which was launched in 2010, has currently facilitated over £1 Billion in loans to British businesses. It has also returned on average 6.6% after the exclusion of bad debt, fees etc.&lt;/p&gt;

&lt;p&gt;The platform offers small, and medium businesses loans of up to £1 million, for up to 60 months. Whole or fractional loans are then purchased by individuals/institutions. Since September 2015 loans have been offered with fixed rates determined by FC using the risk category of the company, and the loan terms. There is also a secondary market where individuals can sell loan parts, for a 0.25% fee, at a premium, at parity, or at a discount. Prior to September 2016 loans were auctioned with no fixed rate.&lt;/p&gt;

&lt;p&gt;FC allows the investor to hand pick each loan that they invest in, and the level of your exposure. However investors can also use an automated auto-bid tool that automatically buys loans, on both the primary and secondary markets, based on pre-set options specified by the investor. These include selecting risk levels to lend to, selecting rates to buy loans on the secondary market, and specifying a target maximum exposure to any single loan. These two system lead to a tension, with those that are hand-picking loans being potentially able to manipulate the auto-bid algorithm acting for other investors. As part of this blog series I will be looking further into these strategies.&lt;/p&gt;

&lt;p&gt;Now for some simple visualisations of the FC loan book, with the first step being to load the required packages (unhash for first run).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;#install.packages(&#39;tidyverse&#39;)
library(tidyverse)

#install.packages(&#39;lubridate&#39;)
library(lubridate)

#install.packages(&#39;stargazer&#39;)
library(stargazer)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now to load in the data and display the variable names:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;## File path of loanbook 
df_path  &amp;lt;- &#39;~/data/Funding_circle/loanbook.csv&#39;

## Load data with miss spec as N/A
loanbook &amp;lt;- read_csv(df_path, na=&#39;N/A&#39;)

## var to factors
factor_list &amp;lt;- c(&#39;status&#39;, &#39;credit_band&#39;, &#39;loan_purpose&#39;, &#39;sector&#39;, &#39;business_type_name&#39;, &#39;region_name&#39;, &#39;whole_loan&#39;, &#39;repayment_type&#39;, &#39;security_taken&#39;)
                 
                 
format_factors &amp;lt;- function(factor_list, df){
                   for (var in factor_list)
                   {
                     df[[var]] &amp;lt;- factor(df[[var]])
                   }
                   
                   return(df)
}
loanbook &amp;lt;- format_factors(factor_list, loanbook)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We print the simple summary of the data as a first step (hidden for brevity).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;summary(loanbook)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As the loan book has evolved with time an immediate question is how the number of loans, at each risk level has changed with time. Across all risk bands we see that year on year loan acceptances have increased, with 2016 showing by far the largest growth. Notably we see the introduction of D loans in 2013, and the introduction of E loans in 2015. The vast majority of funding circle loans are with &amp;lsquo;low risk&amp;rsquo; borrowers (i.e A, and A+), although the number of risky loans is now greater than the entire loan book in 2014&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt; #Plot incidence - by year
loanbook %&amp;gt;% 
    mutate(month = floor_date(loan_accepted_date, &amp;quot;month&amp;quot;)) %&amp;gt;%
        count(month, credit_band) %&amp;gt;% 
        ggplot(aes(x=month, y=n, fill=credit_band)) + 
          geom_area() -&amp;gt; p1
p1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/figure-html/offer-year-1.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;p&gt;We now aggregate by month so that we can understand patterns of loan acceptances across the risk bands. For all risk bands we see that there is a increasing trend towards the end of the year, with the fewest loans originated in April, and March, indicating that this may not be a good time to move funds into FC, and consequently this may lead to an up-tick in the secondary market. E loans show the strongest growth in the second half of the year - however this may be an artefact of their relatively recent introduction, which maybe responsible for this apparent trend.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;loanbook %&amp;gt;%
        mutate(month = month(loan_accepted_date, label=TRUE)) %&amp;gt;%
        ggplot(aes(x=month)) + 
          geom_bar() + 
            facet_wrap(~credit_band, scale=&#39;free&#39;) + 
            theme(axis.text.x = element_text(angle=45)) -&amp;gt; p2
p2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/figure-html/monthly-risk-band-1.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;p&gt;Finally we aggregate by day. There is limited evidence here that loan acceptances vary between weekdays, with a slight upward tick mid week.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;loanbook %&amp;gt;%
        mutate(day = wday(loan_accepted_date, label=TRUE)) %&amp;gt;%
        ggplot(aes(x=day)) + 
          geom_bar() + 
            facet_wrap(~credit_band, scale=&#39;free&#39;) + 
            theme(axis.text.x = element_text(angle=90)) -&amp;gt; p5
p5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/figure-html/daly-risk-band-1.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;p&gt;To link these trends to demand from investors we plot the average interest rate of each accepted loan. We see that average rates are linked with supply for historic loans that were accepted using the biding system. However as expected since the introduction of the fixed rate loan system supply is now uncoupled from price, this presents possible advantages for the hand-picking investor who can buy loans at times of peak supply and sell loans at times of scarcity at a premium on the secondary market.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;plot_monthly_risk_band &amp;lt;- function(df, years)
{
  df %&amp;gt;%
        mutate(month = month(loan_accepted_date, label=TRUE)) %&amp;gt;%
           mutate(year = year(loan_accepted_date)) %&amp;gt;% 
                filter(year %in% years) %&amp;gt;% 
                   group_by(month, credit_band, year) %&amp;gt;% 
                      summarise(`Avg interest rate`=mean(interest_rate)) %&amp;gt;% 
                          ggplot(aes(x=month, y=`Avg interest rate`, shape=credit_band, color=credit_band, fill=credit_band, group=credit_band))  +
                              geom_line() +
                                facet_wrap(~year, scale=&#39;free&#39;) +
                                  theme(axis.text.x = element_text(angle=45)) -&amp;gt; p
  return(p)
}

p3 &amp;lt;- plot_monthly_risk_band(loanbook, c(2010:2013))
p4 &amp;lt;- plot_monthly_risk_band(loanbook, c(2014:2016))
p3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/figure-html/monthly-risk-band-split-by-year-1.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;p4
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://samabbott.co.uk/post/2017-06-10-vis-fc-loanbook-md/figure-html/monthly-risk-band-split-by-year-2.png&#34; alt=&#34;&#34; /&gt;&lt;!-- --&gt;&lt;/p&gt;

&lt;p&gt;This blog series will be bi-weekly, please comment with suggestions of topics. The code for this post can be found at the &lt;a href=&#34;https://github.com/clapping-bunny/funding_circle&#34; target=&#34;_blank&#34;&gt;Github repo&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
